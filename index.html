<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Gerencial - Olharys</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .admin-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 450px; }
        h2 { color: #0c1c2c; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #00d2d3; padding-bottom: 10px; display: inline-block; width: 100%; }
        
        label { font-weight: 600; color: #555; display: block; margin-bottom: 5px; margin-top: 15px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        
        button { width: 100%; padding: 15px; background: #0c1c2c; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        button:hover { background: #00d2d3; color: #0c1c2c; }
        
        #status { text-align: center; margin-top: 15px; font-weight: bold; min-height: 20px; }
        .hint { font-size: 0.8rem; color: #888; margin-top: -10px; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="admin-card">
    <h2>üìÖ Gerenciador de Agenda</h2>

    <label>1. Cidade de Atendimento</label>
    <select id="cidade" onchange="atualizarProfissionais()">
        <option value="">Selecione...</option>
        <option value="Umuarama">Umuarama</option>
        <option value="Perobal">Perobal</option>
        <option value="Douradina">Douradina</option>
        <option value="Palotina">Palotina</option>
        <option value="Marechal C. Rondon">Marechal C. Rondon</option>
        <option value="Toledo">Toledo</option>
        <option value="Altonia">Altonia</option>
        <option value="Cascavel">Cascavel</option>
    </select>

    <label>2. Especialidade</label>
    <select id="tipo" onchange="atualizarProfissionais()">
        <option value="Optometrista">Optometrista</option>
        <option value="Oftalmologista">Oftalmologista</option>
    </select>

    <label>3. Profissional Respons√°vel</label>
    <select id="profissional">
        <option value="">Selecione cidade e tipo primeiro...</option>
    </select>
    <span class="hint">Lista exclusiva da cidade selecionada.</span>

    <div style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label>Data</label>
            <input type="date" id="data">
        </div>
        <div style="flex: 1;">
            <label>Hora</label>
            <input type="time" id="hora">
        </div>
    </div>

    <button onclick="salvarHorario()">LIBERAR HOR√ÅRIO NA AGENDA</button>
    <div id="status"></div>
</div>

<script>
    // ======================================================
    // COLE SUA URL DO GOOGLE APPS SCRIPT ABAIXO
    // ======================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby85zObFW0ot6Hj2QN1n4FYIPe7jvhyISbIzSGF5bHD4qvMgpKXPiqe5t2C10L5bciN/exec"; 

    // --- BASE DE DADOS DOS PROFISSIONAIS (N√ÉO MISTURA CIDADES) ---
    const equipePorCidade = {
        "Umuarama": {
            "Optometrista": ["Guilherme Silva", "Lucas Souza", "Mariana Oliveira", "Beatriz Santos", "Rafael Lima"],
            "Oftalmologista": ["Dr. Eduardo Sodr√©", "Dra. Juliana Mendes", "Dr. Roberto Campos"]
        },
        "Perobal": {
            "Optometrista": ["Ana Paula", "Bruno Costa", "Carla Dias", "Daniela Rocha", "Felipe Melo"],
            "Oftalmologista": ["Dr. Marcos Vinicius", "Dra. Helena K.", "Dr. Paulo Ricardo"]
        },
        "Douradina": {
            "Optometrista": ["Gabriela T.", "Hugo N.", "Igor P.", "Julia R.", "Kleber S."],
            "Oftalmologista": ["Dr. Cesar Augusto", "Dra. Larissa B.", "Dr. Ot√°vio F."]
        },
        "Palotina": {
            "Optometrista": ["Luan V.", "Mirella X.", "Nicolas Z.", "Olivia A.", "Pedro B."],
            "Oftalmologista": ["Dr. Tiago M.", "Dra. Vanessa L.", "Dr. Wesley K."]
        },
        "Marechal C. Rondon": {
            "Optometrista": ["Quirino C.", "Raquel D.", "Samuel E.", "Tatiane F.", "Ulisses G."],
            "Oftalmologista": ["Dr. Yuri H.", "Dra. Zilda I.", "Dr. Andr√© J."]
        },
        "Toledo": {
            "Optometrista": ["Victor K.", "Wagner L.", "Xavier M.", "Yasmin N.", "Zeca O."],
            "Oftalmologista": ["Dr. Bento P.", "Dra. Cecilia Q.", "Dr. Davi R."]
        },
        "Altonia": {
            "Optometrista": ["Amanda S.", "Breno T.", "Camila U.", "Diego V.", "Elisa W."],
            "Oftalmologista": ["Dr. Fabio X.", "Dra. Giovana Y.", "Dr. Helio Z."]
        },
        "Cascavel": {
            "Optometrista": ["Isabela A.", "Jo√£o B.", "Karina C.", "Leonardo D.", "Monica E."],
            "Oftalmologista": ["Dr. Nelson F.", "Dra. Patricia G.", "Dr. Quintino H."]
        }
    };

    function atualizarProfissionais() {
        const cidade = document.getElementById("cidade").value;
        const tipo = document.getElementById("tipo").value;
        const selectProf = document.getElementById("profissional");
        
        selectProf.innerHTML = ""; // Limpa lista anterior

        if (!cidade) {
            selectProf.innerHTML = "<option>Selecione a cidade...</option>";
            return;
        }

        // Busca a lista espec√≠fica da cidade e especialidade
        const listaNomes = equipePorCidade[cidade][tipo];

        if (listaNomes) {
            listaNomes.forEach(nome => {
                let option = document.createElement("option");
                // Salva no formato: "Nome (Tipo)" para ficar claro no Banco de Dados
                option.value = `${nome} - ${tipo}`; 
                option.text = nome;
                selectProf.appendChild(option);
            });
        } else {
            selectProf.innerHTML = "<option>Sem profissionais cadastrados</option>";
        }
    }

    function salvarHorario() {
        const btn = document.querySelector("button");
        const status = document.getElementById("status");
        
        const cidade = document.getElementById("cidade").value;
        const profissional = document.getElementById("profissional").value;
        const data = document.getElementById("data").value;
        const hora = document.getElementById("hora").value;

        if(!cidade || !profissional || !data || !hora) {
            alert("Preencha todos os campos!"); return;
        }

        btn.disabled = true;
        btn.innerText = "Salvando...";
        status.innerText = "";

        const payload = {
            action: "criar_horario",
            cidade: cidade,
            profissional: profissional,
            data: data,
            hora: hora
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            if(data.result === "success") {
                status.style.color = "green";
                status.innerText = "‚úÖ Hor√°rio Liberado com Sucesso!";
                document.getElementById("hora").value = ""; 
            } else {
                status.style.color = "red";
                status.innerText = "Erro ao salvar.";
            }
        })
        .catch(err => {
            status.style.color = "red";
            status.innerText = "Erro de conex√£o.";
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerText = "LIBERAR HOR√ÅRIO NA AGENDA";
        });
    }
</script>

</body>
</html>
