<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Gerencial - Olharys</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .admin-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 450px; }
        h2 { color: #0c1c2c; text-align: center; margin-bottom: 25px; border-bottom: 2px solid #00d2d3; padding-bottom: 10px; display: inline-block; width: 100%; }
        
        label { font-weight: 600; color: #555; display: block; margin-bottom: 5px; margin-top: 15px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        
        button { width: 100%; padding: 15px; background: #0c1c2c; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        button:hover { background: #00d2d3; color: #0c1c2c; }
        
        #status { text-align: center; margin-top: 15px; font-weight: bold; min-height: 20px; }
        .hint { font-size: 0.8rem; color: #888; margin-top: -10px; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="admin-card">
    <h2>üìÖ Gerenciador de Agenda</h2>

    <label>1. Cidade de Atendimento</label>
    <select id="cidade" onchange="atualizarProfissionais()">
        <option value="">Selecione...</option>
        <option value="Curitiba">Curitiba</option>
        <option value="Londrina">Londrina</option>
        <option value="Maring√°">Maring√°</option>
        <option value="Cascavel">Cascavel</option>
        <option value="Ponta Grossa">Ponta Grossa</option>
        <option value="Foz do Igua√ßu">Foz do Igua√ßu</option>
        <option value="S√£o Jos√© dos Pinhais">S√£o Jos√© dos Pinhais</option>
        <option value="Colombo">Colombo</option>
    </select>

    <label>2. Especialidade</label>
    <select id="tipo" onchange="atualizarProfissionais()">
        <option value="Optometrista">Optometrista</option>
        <option value="Oftalmologista">Oftalmologista</option>
    </select>

    <label>3. Profissional Respons√°vel</label>
    <select id="profissional">
        <option value="">Selecione cidade e tipo primeiro...</option>
    </select>
    <span class="hint">Lista gerada automaticamente para a cidade selecionada.</span>

    <div style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label>Data</label>
            <input type="date" id="data">
        </div>
        <div style="flex: 1;">
            <label>Hora</label>
            <input type="time" id="hora">
        </div>
    </div>

    <button onclick="salvarHorario()">LIBERAR HOR√ÅRIO NA AGENDA</button>
    <div id="status"></div>
</div>

<script>
    // ======================================================
    // COLE SUA URL DO GOOGLE APPS SCRIPT ABAIXO (ENTRE AS ASPAS)
    // ======================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby85zObFW0ot6Hj2QN1n4FYIPe7jvhyISbIzSGF5bHD4qvMgpKXPiqe5t2C10L5bciN/exec"; 

    // BANCO DE DADOS FICT√çCIO DE NOMES
    const nomesOpto = ["Guilherme", "Lucas", "Mariana", "Beatriz", "Rafael"];
    const nomesOftalmo = ["Dr. Eduardo Sodr√©", "Dra. Juliana Mendes"];

    function atualizarProfissionais() {
        const cidade = document.getElementById("cidade").value;
        const tipo = document.getElementById("tipo").value;
        const selectProf = document.getElementById("profissional");
        
        selectProf.innerHTML = ""; // Limpa lista

        if (!cidade) {
            selectProf.innerHTML = "<option>Selecione a cidade...</option>";
            return;
        }

        let listaNomes = [];
        if (tipo === "Optometrista") {
            listaNomes = nomesOpto; // Usa os 5 nomes base
        } else {
            listaNomes = nomesOftalmo; // Usa os 2 nomes base
        }

        // Gera as op√ß√µes combinando Nome + Tipo
        listaNomes.forEach(nome => {
            let option = document.createElement("option");
            // Ex: "Guilherme - Optometrista"
            option.value = `${nome} - ${tipo}`; 
            option.text = nome;
            selectProf.appendChild(option);
        });
    }

    function salvarHorario() {
        const btn = document.querySelector("button");
        const status = document.getElementById("status");
        
        const cidade = document.getElementById("cidade").value;
        const profissional = document.getElementById("profissional").value;
        const data = document.getElementById("data").value;
        const hora = document.getElementById("hora").value;

        if(!cidade || !profissional || !data || !hora) {
            alert("Preencha todos os campos!"); return;
        }

        btn.disabled = true;
        btn.innerText = "Salvando...";
        status.innerText = "";

        const payload = {
            action: "criar_horario",
            cidade: cidade,
            profissional: profissional,
            data: data,
            hora: hora
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
            if(data.result === "success") {
                status.style.color = "green";
                status.innerText = "‚úÖ Hor√°rio Liberado com Sucesso!";
                // Limpa apenas data/hora para facilitar cadastrar o pr√≥ximo
                document.getElementById("hora").value = ""; 
            } else {
                status.style.color = "red";
                status.innerText = "Erro ao salvar.";
            }
        })
        .catch(err => {
            status.style.color = "red";
            status.innerText = "Erro de conex√£o.";
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerText = "LIBERAR HOR√ÅRIO NA AGENDA";
        });
    }
</script>

</body>
</html>
